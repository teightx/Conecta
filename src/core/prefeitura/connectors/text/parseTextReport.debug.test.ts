import { describe, it, expect } from 'vitest'
import { parseTextReport } from './parseTextReport'

describe('parseTextReport - PDF real', () => {
  it('deve extrair corretamente do PDF com colunas separadas', () => {
    // Simular o texto extraído do PDF real
    const pdfText = `Matrícula
9-1 1/0
24-1 1/0
26-1 1/0
28-1 1/0
28-1 1/0
31-1 1/0
36-1 1/0
36-1 1/0
36-1 1/0
42-1 1/0
43-1 1/0
44-1 1/0
45-1 1/0
46-1 1/0
50-1 1/0
53-1 1/0
53-1 1/0
53-1 1/0
53-1 1/0
57-1 1/0
63-1 1/0
64-1 1/0
64-1 1/0
64-1 1/0
66-1 1/0
66-1 1/0
66-1 1/0
66-1 1/0
69-1 1/0
74-1 1/0
74-1 1/0
74-1 1/0
74-1 1/0
78-1 1/0
80-1 1/0
83-1 1/0
85-1 1/0
85-1 1/0
88-1 1/0
90-1 1/0
90-1 1/0
91-1 1/0
92-1 1/0
92-1 1/0
99-1 1/0
99-1 1/0
102-1 1/0
104-1 1/0
114-1 1/0
118-1 1/0
118-1 1/0
118-1 1/0
118-1 1/0
121-1 1/0
PREFEITURA MUNICIPAL DE ESPERANTINOPOLIS Mês/Ano
RUA GETULIO VARGAS, 434, CENTRO. ESPERANTINOPOLIS-MA
CNPJ: 06.376.669/0001-69 Folha
Mensal	Página 1 de 14
Relação de Trabalhadores por Evento
Nome do Trabalhador Referência Qtde. Valor
Evento: 002 - CONSIGNADO BB
EDIMAR FERREIRA SANTOS 570.251.503-04 0,00 537,88
JOELMA DE ABREU DE SOUZA 010.743.803-80 0,00 333,40
MARIA LUCIA FELIX BORGES BARBOSA LOPES 838.889.183-91 0,00 972,80
HUDIVANE DA SILVA BRITO GALVAO 782.397.703-63 0,00 347,17
HUDIVANE DA SILVA BRITO GALVAO 782.397.703-63 0,00 156,54
EDES LOPES DO NASCIMENTO 197.384.123-15 0,00 75,47
AIRTON BRASIL OLIVEIRA 007.533.033-45 0,00 164,29
AIRTON BRASIL OLIVEIRA 007.533.033-45 0,00 199,40
AIRTON BRASIL OLIVEIRA 007.533.033-45 0,00 165,14
FRANCISCA FERREIRA BEZERRA DOS SANTOS 850.971.443-68 0,00 504,78
GILMARIO DE MELO SILVA 716.691.833-00 0,00 536,89
MARIA ANTONIA SILVA DA PAZ SOUSA 024.804.423-06 0,00 289,17
ARIOSVALDO DE SOUSA OLIVEIRA 003.306.973-58 0,00 20,86
SELMA RODRIGUES PEREIRA NASCIMENTO 949.150.083-04 0,00 179,00
HUDINEIA DA SILVA BRITO 851.864.653-72 0,00 200,86
JOAO ALBERTO SANTOS SOUZA 466.388.573-04 0,00 6,57
JOAO ALBERTO SANTOS SOUZA 466.388.573-04 0,00 101,10
JOAO ALBERTO SANTOS SOUZA 466.388.573-04 0,00 275,32
JOAO ALBERTO SANTOS SOUZA 466.388.573-04 0,00 82,25
SUZANA PEREIRA DE SOUZA 001.619.583-38 0,00 499,52
CLAUDIANE DE PINHO GOMES DA SILVA 010.883.033-07 0,00 489,99
MARIA DAS LUZ FELIX BORGES 917.877.933-20 0,00 19,71
MARIA DAS LUZ FELIX BORGES 917.877.933-20 0,00 109,64
MARIA DAS LUZ FELIX BORGES 917.877.933-20 0,00 489,52
DAYANE PAZ DE SOUSA MARTINS 007.146.333-05 0,00 129,62
DAYANE PAZ DE SOUSA MARTINS 007.146.333-05 0,00 95,35
DAYANE PAZ DE SOUSA MARTINS 007.146.333-05 0,00 318,35
DAYANE PAZ DE SOUSA MARTINS 007.146.333-05 0,00 24,41
SANNAYK DA SILVA NERY 846.597.853-00 0,00 673,18
JOSEFA DE ARAUJO RIBEIRO 932.827.103-72 0,00 379,43
JOSEFA DE ARAUJO RIBEIRO 932.827.103-72 0,00 52,86
JOSEFA DE ARAUJO RIBEIRO 932.827.103-72 0,00 495,29
JOSEFA DE ARAUJO RIBEIRO 932.827.103-72 0,00 194,42
GUILHERMINA PAULINO DO NASCIMENTO 028.017.323-70 0,00 186,08
CRISTIANO DE MORAIS ROCHA 994.313.863-72 0,00 533,80
IZABEL CRISTINA ROCHA VERAS 673.899.023-53 0,00 582,94
REGINALDO RODRIGUES 000.281.393-99 0,00 400,49
REGINALDO RODRIGUES 000.281.393-99 0,00 26,83
MARIA VILANI VIEIRA RODRIGUES 196.839.103-78 0,00 469,17
FRANCISCA GILVANE RIBEIRO MENDES 695.609.513-00 0,00 507,96
FRANCISCA GILVANE RIBEIRO MENDES 695.609.513-00 0,00 552,83
RAIMUNDA MARQUES SILVA 280.032.093-15 0,00 340,28
ALVANI SOARES ELOI 849.860.183-53 0,00 972,43
ALVANI SOARES ELOI 849.860.183-53 0,00 30,16
MARIA WILLANA RODRIGUES SILVA 000.709.903-79 0,00 268,23
MARIA WILLANA RODRIGUES SILVA 000.709.903-79 0,00 126,47
ROSANGELA FELIX SOARES 922.252.683-04 0,00 689,40
FLORES BELA COSTA ARAUJO 968.323.803-30 0,00 257,79
FRANCISCA HERNILENE ALVES LOPES 508.857.902-00 0,00 412,89
ZAQUIEL FERNANDES MONTEIRO 688.205.343-04 0,00 54,46
ZAQUIEL FERNANDES MONTEIRO 688.205.343-04 0,00 163,63
ZAQUIEL FERNANDES MONTEIRO 688.205.343-04 0,00 651,54
ZAQUIEL FERNANDES MONTEIRO 688.205.343-04 0,00 173,13
MARIA GECILENE SOARES OLIVEIRA 917.890.523-00 0,00 291,50
Fiorilli S/C Software Ltda.`

    const result = parseTextReport(pdfText)
    
    console.log('Result:', {
      rows: result.rows.length,
      competencia: result.competencia,
      eventosDetectados: result.eventosDetectados,
      diagnostics: result.diagnostics,
    })
    
    if (result.rows.length > 0) {
      console.log('Primeiras 5 rows:', result.rows.slice(0, 5))
    }

    // Deve extrair pelo menos algumas linhas
    expect(result.rows.length).toBeGreaterThan(0)
    
    // Verificar primeira linha
    if (result.rows.length > 0) {
      expect(result.rows[0].matricula).toBe('9-1')
      expect(result.rows[0].valor).toBe(537.88)
      expect(result.rows[0].meta?.nome).toBe('EDIMAR FERREIRA SANTOS')
      expect(result.rows[0].meta?.cpf).toBe('570.251.503-04')
    }
  })
})
